# ================================================================
# NiO: 2 Ni and 2 O atoms in a fcc supercell
#
# Test for Abinit: PAW + U + magnetism (collinear and non-collinear)
# Low cut-off for test; too few k-points
# ================================================================

# === Datasets
ndtset 4
nsppol1 1  nspden1 1  nspinor1 1  ! non-magnetic
nsppol2 2  nspden2 2  nspinor2 1  ! ferro-magnetic
nsppol3 1  nspden3 2  nspinor3 1  ! antiferro-magnetic
nsppol4 1  nspden4 4  nspinor4 2  ! non-collinear magnetism
prtwf1 1 prtwf2 1 getwfk3 2
#getwfk4 1

# === Structure and cell
natom 4 ntypat 2 typat 1 1 2 2
spinat 0 0 2  0 0  -2  0 0 0  0 0  0
znucl  28.0 8.0
xred 0 0 0
    0.0 0.0 0.5
    0.5 0.5 0.25
    0.5 0.5 0.75
acell   *7.92
rprim 0.0 1/2 1/2
      1/2 0.0 1/2
      1.0 1.0 0.0
nband 24 nband4 48
occopt 6 tsmear 0.005

# === SCF cycle options
nstep 9
tolvrs 1.d-7
ecut 8. pawecutdg 10.
diemix 1. dielng 3.
iscf 17 iscf4 7

# === K-points and syms
kptopt 1
kptrlatt 2 0 0 0 2 0 0 0 2
nsym 0 nsym4 1

# === LDA+U options
usepawu 1 usepawu1 0
lpawu   2 -1        # Applied on d electrons of Nickel
upawu  0.30   0.0   # Value of U parameter
jpawu  0.0350 0.0   # Value of J parameter

usedmatpu 5         # An initial density matrix is given (below)
                    # and kept constant during 5 SCF steps

dmatpuopt 2

                    # The initial density matrix
                    # Be careful of the dimensions:
                    #  * +U is applied on d electrons: 5x5 matrixes are required
                    #  * +U is applied for 2 (nickel) atoms

                    # DATASET 1: max(nsppol,nspinor)=1
                    #            1 matrix per atom is required
dmatpawu1
     # Ni atom 1 - spin up occupations
     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    1.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    1.00000

     # Ni atom 2 - spin up occupations
     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000
dmatpawu2
                    # DATASET 2: max(nsppol,nspinor)=2
                    #            2 matrixes per atom are required
     # Ni atom 1 - spin up and spin down occupations
     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    1.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    1.00000

     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000

     # Ni atom 2 - spin up and spin down occupations
     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000

     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    1.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    1.00000
dmatpawu3
                    # DATASET 3: max(nsppol,nspinor)=1
                    #            1 matrix per atom is required
     # Ni atom 1 - spin up occupations
     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    1.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    1.00000

     # Ni atom 2 - spin up occupations
     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000
dmatpawu4
                    # DATASET 4: max(nsppol,nspinor)=2
                    #            2 matrixes per atom are required
     # Ni atom 1  -"integrated" spin up and spin down occupations
     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    1.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    1.00000

     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000

     # Ni atom 2 - "integrated" spin up and spin down occupations
     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    0.00000

     1.00000    0.00000    0.00000    0.00000    0.00000
     0.00000    1.00000    0.00000    0.00000    0.00000
     0.00000    0.00000    1.00000    0.00000    0.00000
     0.00000    0.00000    0.00000    1.00000    0.00000
     0.00000    0.00000    0.00000    0.00000    1.00000
#   NOTE: THE ABOVE VALUE For Ni atom 2 IS ERRONEOUS;
#         TO ENFORCE ANTIFERROMAGNETISM, THIS SHOULD BE:
#         (WILL BE CORRECTED IN THE NEXT VERSION)
#         ANTIFERRO CHARACTER IS ENFORCE BY SPINAT VALUE.
#     1.00000    0.00000    0.00000    0.00000    0.00000
#     0.00000    1.00000    0.00000    0.00000    0.00000
#     0.00000    0.00000    1.00000    0.00000    0.00000
#     0.00000    0.00000    0.00000    1.00000    0.00000
#     0.00000    0.00000    0.00000    0.00000    1.00000
#
#     1.00000    0.00000    0.00000    0.00000    0.00000
#     0.00000    1.00000    0.00000    0.00000    0.00000
#     0.00000    0.00000    0.00000    0.00000    0.00000
#     0.00000    0.00000    0.00000    1.00000    0.00000
#     0.00000    0.00000    0.00000    0.00000    0.00000

# === Other options
prtden 0  prteig 0  prtwf 0
optforces 0
