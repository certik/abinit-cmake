#
#  the sequence of datasets makes the ground states and
#   all of the explicit perturbations of the single
#   Al atom in all directions, for the irreducible
#   qpoints in a 2x2x2 grid.
#
ndtset 5


#
# DATASET 1 : make ground state wavefunctions and density
# 
nline1 8          # This is to expedite the convergence of higher-lying bands
tolwfr1 1.0d-14
tolvrs1 0.0       # this is to remove the default above: we want the wf converged
nqpt1 0           # remove default
getwfk1 0         # remove default
rfphon1 0         # remove default

#
#defaults for all phonon runs
#
prepgkk 1     # flag to calculate all perturbations for el-phon calculations
#prtgkk 1      # print out gkk files directly - not compatible with prepgkk however
nqpt 1        # 1 qpoint at a time
tolvrs 1.e-5  # tolerance on 2DTE convergence: potential^(1) is what we need
getwfk 1      # all other DS get wf from DS1
rfatpol 1 1   # all atoms are perturbed
rfdir 1 1 1   # all directions of perturbation
rfphon 1

qpt2   0.0 0.0 0.0 #  qpoint Gamma
qpt3   0.5 0.0 0.0 #  qpoint 1/2 0 0
qpt4   0.5 0.5 0.0 #  qpoint X= 1/2 1/2 0

# DS5 get ddk 
rfphon5   0             # no phonons here
rfelfd5   2             # Activate the calculation of the d/dk perturbation
   qpt5   0.0 0.0 0.0   # This is a calculation at the Gamma point
  iscf5  -3             # The d/dk perturbation must be treated non SC-ly
tolwfr5   1.0d-14       # Must use tolwfr for non-self-consistent calculations
tolvrs5   0.0           # this is to remove the default above: we want the wf converged


#  the kpoint grid is minimalistic to keep the calculation
#   manageable.
ngkpt 4 4 4
kptopt 3

#  as is the kinetic energy cutoff
ecut 4.0

#  use a centered grid for the kpoints
nshiftk 1
shiftk 0.0 0.0 0.0

#
#  Common data
#

acell 3*7.5
rprim 
 0.0 0.5 0.5
 0.5 0.0 0.5
 0.5 0.5 0.0

nband 10

#  include metallic occupation function with a small smearing
occopt 7
tsmear 0.001
natom 1
typat 1
xred 0.00 0.00 0.00
nstep 800
ntypat 1 
znucl 13 
