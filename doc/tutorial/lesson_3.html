<html>
<head>
<title> ABINIT. Tutorial #3</title>
</head>
<body bgcolor="#ffffff">

<hr>
<h1>ABINIT, third lesson of the tutorial: </h1>
<h2>Crystalline silicon. </h2>
<hr>
<p>This lesson aims at showing you how to get 
the following physical properties, for an insulator :
<ul>
<li>the total energy
<li>the lattice parameter
<li>the band structure (actually, the Kohn-Sham band structure)
</ul>
You will learn about the use of k-points, as well
as the smearing of the plane-wave kinetic energy cut-off.

<p>This lesson should take about 1 hour to be done.

<h5>Copyright (C) 2000-2008 ABINIT group (XG,RC)
<br> This file is distributed under the terms of the GNU General Public License, see
~abinit/COPYING or <a href="http://www.gnu.org/copyleft/gpl.txt">
http://www.gnu.org/copyleft/gpl.txt </a>.
<br> For the initials of contributors, see ~abinit/doc/developers/contributors.txt .
</h5>

<HR ALIGN=left>
Goto :
<A href="http://www.abinit.org"><B>ABINIT home Page</B></A>
<B> | </B>
<A href="../users/acknowledgments.html"><B>Suggested acknowledgments</B></A>
<B> | </B>
<A href="../input_variables/keyhr.html"><B>List of input variables</B></A>
<B> | </B>
<A href="welcome.html"><B>Tutorial home page</B></A>
<B> | </B>
<A href="../users/bibliography.html"><B>Bibliography</B></A>
<HR ALIGN=left>
Help files :
<A href="../users/new_user_guide.html"><B>New user's guide</B></A>
<B> | </B>
<A href="../users/abinis_help.html"><B>Abinis (main)</B></A>
<B> | </B>
<A href="../users/respfn_help.html"><B>Abinis (respfn)</B></A>
<B> | </B>
<A href="../users/mrgddb_help.html"><B>Mrgddb</B></A>
<B> | </B>
<A href="../users/anaddb_help.html"><B>Anaddb</B></A>
<B> | </B>
<A href="../users/aim_help.html"><B>AIM (Bader)</B></A>
<B> | </B>
<A href="../users/cut3d_help.html"><B>Cut3D</B></A>
<B> | </B>
<A href="../users/optic_help.html"><B>Optic</B></A>
<B> | </B>
<A href="../users/mrgscr_help.html"><B>Mrgscr</B></A>
<HR ALIGN=left>


<br>&nbsp;
<h3><b>Content of lesson 3</b></h3>

<ul>
  <li><a href="lesson_3.html#31">3.1</a> Computing the total energy of silicon at 
    fixed number of k points.</li>
  <li><a href="lesson_3.html#32">3.2</a> Starting the convergence study with respect 
    to k points</li>
  <li><a href="lesson_3.html#33">3.3</a> Actually performing the convergence study 
    with respect to k points</li>
  <li><a href="lesson_3.html#34">3.4</a> Determination of the lattice parameters</li>
  <li><a href="lesson_3.html#35">3.5</a> Computing the band structure</li>
</ul>

<br>
<hr>

<a name="31">&nbsp;</a>
<h3><b>
3.1. 
Computing the total energy of silicon at fixed number of k points.
</b></h3>

<p><i>Before beginning, you might consider to work in a different subdirectory
  as for lesson_1 or lesson_2 . Why not "Work3" ?</i>

<p>The file ~abinit/tests/tutorial/Input/t3x.files lists the file 
  names and root names. You can copy it in the Work3 directory and change it 
  as you did for the t1x.files and t2x.files files. You can also copy 
  the file ~abinit/tests/tutorial/Input/t31.in in Work3. This is your 
  input file. You should edit it, read it carefully, have a look at the following 
  "new" input variables, and their explanation : 
<ul>
  <li><a href="../input_variables/varbas.html#rprim" target="kwimg">rprim</a> 
  <li><a href="../input_variables/varbas.html#xred" target="kwimg">xred</a> (used instead of xcart) 
  <li><a href="../input_variables/varbas.html#kptopt" target="kwimg">kptopt</a>, 
    <a href="../input_variables/varbas.html#ngkpt" target="kwimg">ngkpt</a>, 
    <a href="../input_variables/varbas.html#nshiftk" target="kwimg">nshiftk</a> 
    <a href="../input_variables/varbas.html#shiftk" target="kwimg">shiftk</a> 
    <a href="../input_variables/vargs.html#kptrlatt" target="kwimg">kptrlatt</a> 
    (not easy ... take your time !) 
  <li><a href="../input_variables/vargs.html#diemac" target="kwimg">diemac</a> (compared to isolated 
    molecules, another value is used, while <a href="../input_variables/vargs.html#diemix" target="kwimg">diemix</a> 
    has been suppressed). 
</ul>
<p>Note also the following :
  you will work at fixed <a href="../input_variables/varbas.html#ecut" target="kwimg">ecut</a> 
    (=8Ha). It is implicit that in "real life", 
  you should do a convergence test with respect to 
  <a href="../input_variables/varbas.html#ecut" target="kwimg">ecut</a> ... 
<br>
Here, a suitable <a href="../input_variables/varbas.html#ecut" target="kwimg">ecut</a> is given 
to you. It will allow to obtain 0.2% relative accuracy on lattice parameters. 
<p>When you have read the input file, you can run the code, as usual
 (it will run for a few seconds).
<br>Then, read the output file, and note the total energy.
<pre>
   etotal   -8.8662238960E+00
</pre>

<hr>
<a name="32">&nbsp;</a>
<h3><b>
3.2.
Starting the convergence study with respect to k points
</b></h3>

<p>There is of course a convergence study associated with the sampling 
of the Brillouin zone. You should examine different grids,
of increasing resolution. You might try the following series
of grids :
<pre>
ngkpt1  2 2 2  
ngkpt2  4 4 4  
ngkpt3  6 6 6  
ngkpt4  8 8 8  
</pre>
However, the associated number of k points in the irreducible
Brillouin zone grows very fast. It is
<pre>
nkpt1  2
nkpt2 10
nkpt3 28
nkpt4 60
</pre>
  ABINIT computes automatically this number of k points, from the definition of the grid
  and the symmetries. 
<br>You might nevertheless define an input nkpt value in the input file, 
  in which case ABINIT will compare its computed value (from the grid) with this input
  value. We take this opportunity to examine the behaviour of ABINIT
  when a problem is detected. Let's suppose that with <code>ngkpt1 4 4 4</code> ,
  one mentions <code>nkpt1 2</code> .
  The input file ~abinit/tests/tutorial/Input/t32.in is an example. 
  Do not forget to change t3x.files, 
  if you are using that file name . The message that you get at the end of the 
  log file is : 
<pre>
 inkpts : ERROR -
  The input value of nkpt=     2, does not match
  the number of k points generated by kptopt, ngkpt, shiftk,
  ane the eventual symmetries, that is, nkpt=    10.
  Action : change nkpt in your input file, or one of the other input variables.
</pre>
 
<p>This is a typical ABINIT error message. It announces clearly that you should 
  use <a href="../input_variables/varbas.html#nkpt" target="kwimg">nkpt</a> 10. </p>

<p>As the computation of <a href="../input_variables/varbas.html#nkpt" target="kwimg">nkpt</a>
for specific grids of k points is not an easy task, while the even more 
important selection of specific economical grids (the best ratio
between the accuracy of the integration in the Brillouin zone
and the number of k-points) is more difficult, some help to the
user is provided by ABINIT. ABINIT is able to examine automatically
different k point grids, and to propose the best grids for integration.
This is described in the abinis_help file, see the input
variable <a href="../input_variables/varfil.html#prtkpt" target="kwimg">prtkpt</a>,
and the associated characterisation of the integral accuracy, described
in <a href="../input_variables/vargs.html#kptrlen" target="kwimg">kptrlen</a>.
The generation of lists of k-point sets is done in different test cases,
in the directory ~abinit/test/v2 . You can directly have a look at the output
files in ~abinit/test/v2/Refs , the output files for the tests 61 to 73.

<p>When one begins the study of a new material, it is strongly advised
to examine first the list of k points grids, and select (at least)
three efficient ones, for the k point convergence study.
Do not forget that the CPU time will be linearly proportional to the
number of k points to be treated : using 10 k points will take five
more time than using 2 k points. Even for a similar accuracy of the
Brillouin zone integration (about the same value of 
<a href="../input_variables/vargs.html#kptrlen" target="kwimg">kptrlen</a>), 
it might be easy to generate a grid
that will fold to 10 k points in the irreducible Brillouin zone, as well as
one that will fold to 2 k points in the irreducible Brillouin zone. 
The latter is clearly to be preferred !
<p>
<hr>

<p> <a name="33">&nbsp;</a> </p>
<h3><b>
3.3.
Actually performing the convergence study with respect to k points
</b></h3>

<p>In order to understand k-point grids, you should read the Monkhorst and Pack 
  paper, <cite>Phys. Rev. B 13, 5188 (1976)</cite> ... Well, maybe not immediately 
  ... In the meantime, you can try the above-mentioned convergence study. 
<p>The input file ~abinit/tests/tutorial/Input/t33.in is an example, 
  while ~abinit/tests/tutorial/Refs/t33.out is a reference output 
  file. In this output file, you should have a look at the echo of input variables. 
  As you know, these are preprocessed, and, in particular, <a href="../input_variables/varbas.html#ngkpt" target="kwimg">ngkpt</a> 
  and <a href="../input_variables/varbas.html#shiftk" target="kwimg">shiftk</a> are used to generate 
  the list of k points (<a href="../input_variables/varbas.html#kpt" target="kwimg">kpt</a>) and 
  their weights (<a href="../input_variables/varbas.html#wtk" target="kwimg">wtk</a>). You should 
  read the information about <a href="../input_variables/varbas.html#kpt" target="kwimg">kpt</a> 
  and <a href="../input_variables/varbas.html#wtk" target="kwimg">wtk</a>.
<p>From the output file, here is the evolution of total energy per unit cell :

<pre>
    etotal1  -8.8662238960E+00
    etotal2  -8.8724909739E+00
    etotal3  -8.8726017432E+00
    etotal4  -8.8726056405E+00
</pre>
<p>The difference between dataset 3 and dataset 4 is rather small. Even the dataset 
  2 gives an accuracy of about 0.0001 Ha <br>
  So, our converged value for the total energy, at fixed <a href="../input_variables/varbas.html#acell" target="kwimg">acell</a>, 
  fixed <a href="../input_variables/varbas.html#ecut" target="kwimg">ecut</a>, is -8.872 Ha . 

<p>
<hr>



<p> <a name="34">&nbsp;</a> 
<h3><b>
3.4.
Determination of the lattice parameters.
</b></h3>
 
<p>The input variable "<a href="../input_variables/varrlx.html#optcell" target="kwimg">optcell</a>" 
  governs the automatic optimisation of cell shape and volume. <br>
  For the automatic optimisation of cell volume, use :
<pre>
optcell 1
ionmov 3
ntime 10
dilatmx 1.05
ecutsm 0.5
</pre>
<p>You should read the indications about <a href="../input_variables/varrlx.html#dilatmx" target="kwimg">dilatmx</a> 
  and <a href="../input_variables/varrlx.html#ecutsm" target="kwimg">ecutsm</a>. <br>
  Do not test all the k point grids, only those with nkpt 2 and 10.

<p>The input file ~abinit/tests/tutorial/Input/t34.in is an example, 
  while ~abinit/tests/tutorial/Refs/t34.out is a reference output 
  file. <br>
  This run might last a few minutes ...

<p>You should obtain the following evolution
of the lattice parameters : 
<pre>
     acell1   1.0233363682E+01  1.0233363682E+01  1.0233363682E+01 Bohr
     acell2   1.0216447241E+01  1.0216447241E+01  1.0216447241E+01 Bohr
</pre>
with the following very small residual stresses :
<pre>
    strten1   1.8591719160E-07  1.8591719160E-07  1.8591719160E-07
              0.0000000000E+00  0.0000000000E+00  0.0000000000E+00
    strten2  -2.8279720007E-08 -2.8279720007E-08 -2.8279720007E-08
              0.0000000000E+00  0.0000000000E+00  0.0000000000E+00
</pre>
<p>The stress tensor is given in Hartree/Bohr^3, and the order
of the components is
<pre> 
                        11  22  33
                        23  13  12
</pre>
<p>There is only a 0.13% relative difference between <a href="../input_variables/varbas.html#acell" target="kwimg">acell</a>1 
  and <a href="../input_variables/varbas.html#acell" target="kwimg">acell</a>2 . <br>
  So, our converged LDA value for Silicon, with the 14si.pspnc pseudopotential 
  (see the t3x.files file) is 10.217 
  Bohr (actually 10.2163...), that is 5.407 Angstrom. The experimental value is <code>5.431 Angstrom 
  at 25 degree Celsius</code>, see <cite>R.W.G. Wyckoff, Crystal structures 
  Ed. Wiley and sons, New-York (1963).</cite> 
<p>
<hr>
<a name="35">&nbsp;</a> 
<h3><b>3.5.
Computing the band structure</b></h3>

<p>We fix the parameters <a href="../input_variables/varbas.html#acell" target="kwimg">acell</a> 
  to the theoretical value of 3*10.217, and we fix also the grid of k points (the 
  4x4x4 FCC grid, equivalent to a 8x8x8 Monkhorst-pack grid) <br>
  We will ask for 8 bands (4 valence and 4 conduction).

<p>A band structure can be computed by solving the Kohn-Sham equation for
many different k points, along different lines of the Brillouin zone.
<br>The potential that enters the Kohn-Sham must be derived from a previous
self-consistent calculation, and will not vary during the scan of different
k-point lines.
<br>Suppose that you want to make a L-Gamma-X-(U-)Gamma circuit, with 10,
12 and 17 divisions for each line (each segment has a different length
in reciprocal space, and these divisions give approximately the same
distance between points along a line).
<br>The circuit will be obtained easily by the following choice
of segment end points :
<pre>
L     (1/2 0 0)
Gamma (0 0 0)
X     (0 1/2 1/2)
Gamma (1 1 1)     
</pre>
<i>Note : 
<ol>
 <li>the last Gamma point is in another cell of the reciprocal
                   space than the first one, this choice allows to construct
                   the X-U-Gamma line easily ;</li> 
 <li>the k-points are specified
              using reduced coordinates - in agreement with the input setting of the
              primitive 2-atom unit cell - in standard textbooks, you will often find
              the L, Gamma or X point given in coordinates of the conventional
              8-atom cell : the above-mentioned circuit is then
              (1/2 1/2 1/2)-(0 0 0)-(1 0 0)-(1 1 1), but such coordinates 
              cannot be used with the 2-atom cell.</li>
</ol>
</i>
<p>So, you should set up in your input file, for the first dataset, a usual SCF 
  calculation in which you output the density 
  (<a href="../input_variables/varfil.html#prtden" target="kwimg">prtden</a> 
  1), and, for the second dataset : 
<ul>
  <li>fix <a href="../input_variables/varbas.html#iscf" target="kwimg">iscf</a> to -2, to make a 
    non-self-consistent calculation ; 
  <li>define <a href="../input_variables/varfil.html#getden" target="kwimg">getden</a> -1, to take 
    the output density of dataset 1 ; 
  <li>set <a href="../input_variables/varbas.html#nband" target="kwimg">nband</a> to 8 ; 
  <li>set <a href="../input_variables/varbas.html#kptopt" target="kwimg">kptopt</a> to -3, to define 
    three segments in the brillouin Zone ; 
  <li>set <a href="../input_variables/vargs.html#ndivk" target="kwimg">ndivk</a> to 10 12 17  
    (this means a circuit defined by 4 points, with 10 divisions of the first 
    segment, 12 divisions of the second, 17 divisions of the third) 
  <li>set <a href="../input_variables/vargs.html#kptbounds" target="kwimg">kptbounds</a> to 
    <pre>
                0.5  0.0  0.0 # L point
                0.0  0.0  0.0 # Gamma point
                0.0  0.5  0.5 # X point
                1.0  1.0  1.0 # Gamma point in another cell.
</pre>
  <li>set <a href="../input_variables/vargs.html#enunit" target="kwimg">enunit</a> to 1, in order 
    to have eigenenergies in eV 
  <li>the only tolerance criterion admitted for non-self-consistent calculations 
    is <a href="../input_variables/varbas.html#tolwfr" target="kwimg">tolwfr</a>. You should set 
    it to 1.0d-10 (or so), and suppress <a href="../input_variables/varbas.html#toldfe" target="kwimg">toldfe</a>. 
</ul>
<p>The input file ~abinit/tests/tutorial/Input/t35.in is an example, 
  while ~abinit/tests/tutorial/Refs/t35.out is a reference output 
  file. 
<p>You should find the band structure starting at (second dataset):
<pre>
 Eigenvalues (   eV  ) for nkpt=  40  k points:
 kpt#   1, nband=  8, wtk=  1.00000, kpt=  0.5000  0.0000  0.0000 (reduced coord)
  -3.78988  -1.16033   4.69392   4.69392   7.38387   9.23578   9.23578  13.45362
 kpt#   2, nband=  8, wtk=  1.00000, kpt=  0.4500  0.0000  0.0000 (reduced coord)
  -3.92926  -0.95944   4.71017   4.71017   7.40284   9.25270   9.25270  13.48580
 kpt#   3, nband=  8, wtk=  1.00000, kpt=  0.4000  0.0000  0.0000 (reduced coord)
  -4.25585  -0.44580   4.76450   4.76450   7.46439   9.30898   9.30898  13.57381
 kpt#   4, nband=  8, wtk=  1.00000, kpt=  0.3500  0.0000  0.0000 (reduced coord)
  -4.64159   0.24735   4.85455   4.85455   7.56448   9.38019   9.38019  13.64212
 ....
</pre>
<p>One needs a graphical tool to represent all these data ...
(For the MAPR 2451 lecture : try with MATLAB).
In a separate file (_EIG), you will find the list of k-points and eigenenergies
(the input variable <a href="../input_variables/varfil.html#prteig" target="kwimg">prteig</a> is set by default to 1).

<p>Even without a graphical tool we will have a quick look 
at the values at L, Gamma, X and Gamma again :
<pre>
 kpt#   1, nband=  8, wtk=  1.00000, kpt=  0.5000  0.0000  0.0000 (reduced coord)
  -3.78988  -1.16033   4.69392   4.69392   7.38387   9.23578   9.23578  13.45362

 kpt#  11, nband=  8, wtk=  1.00000, kpt=  0.0000  0.0000  0.0000 (reduced coord)
  -6.17103   5.91513   5.91513   5.91513   8.44523   8.44523   8.44523   9.17123

 kpt#  23, nband=  8, wtk=  1.00000, kpt=  0.0000  0.5000  0.5000 (reduced coord)
  -1.96599  -1.96599   3.00345   3.00345   6.50927   6.50927  15.94974  15.94974

 kpt#  40, nband=  8, wtk=  1.00000, kpt=  1.0000  1.0000  1.0000 (reduced coord)
  -6.17103   5.91513   5.91513   5.91513   8.44523   8.44523   8.44523   9.17123
</pre>
The last gamma is exactly equivalent to the first gamma.
It can be checked that the top of the valence band is obtained
at Gamma (=5.91513 eV). The width of the valence band is
12.09 eV, the lowest unoccupied state at X is 0.594 eV higher
than the top of the valence band, at Gamma. The Si is described
as an indirect band gap material (this is correct), with a band-gap of
about 0.594 eV (this is quantitatively quite wrong : the
experimental value 1.17 eV is at 25 degree
Celsius). The minimum of the conduction
band is even slightly displaced with respect to X, see kpt # 21 .
This underestimation of the band gap is well-known (the famous DFT band-gap problem).
In order to obtain correct band gaps, you need to go beyond the
Kohn-Sham Density Functional Theory : use the GW approximation.
This is described in <a href="lesson_gw1.html">the first lesson on the GW approximation</a>.

<p>For experimental data and band structure representation, see 
<br>M.L. Cohen and J.R. Chelikowski
<br><cite>Electronic structure and optical properties of semiconductors</cite>
<br>Springer-Verlag New-York (1988).

<p>There is a subtlety that is worth to comment about. In non-self-consistent
calculations, like those performed in the present band structure calculation,
with <a href="../input_variables/varbas.html#iscf" target="kwimg">iscf</a>=-2, not all bands
are converged within the tolerance <a href="../input_variables/varbas.html#tolwfr" target="kwimg">tolwfr</a>.
Indeed, the two upper bands (by default) have not been taken into account
to apply this convergence criterion: they constitute a "buffer".
The number of such
"buffer" bands is governed by the input variable
<a href="../input_variables/vargs.html#nbdbuf" target="kwimg">nbdbuf</a>.

<p> It can happen that the highest (or two highest) band(s), if not separated by a gap from
non-treated bands, can exhibit a very slow convergence rate. This buffer
allows to achieve convergence of "important", non-buffer bands. 
In the present case, 6 bands have been converged with a residual better
than <a href="../input_variables/varbas.html#tolwfr" target="kwimg">tolwfr</a>, while the
two upper bands are less converged (still sufficiently for graphical representation
of the band structure). In order to achieve the same convergence
for all 8 bands, it is advised to use
<a href="../input_variables/varbas.html#nband" target="kwimg">nband</a>=10 (that is, 8 + 2).

<HR ALIGN=left>
Goto :
<A href="http://www.abinit.org"><B>ABINIT home Page</B></A>
<B> | </B>
<A href="../users/acknowledgments.html"><B>Suggested acknowledgments</B></A>
<B> | </B>
<A href="../input_variables/keyhr.html"><B>List of input variables</B></A>
<B> | </B>
<A href="welcome.html"><B>Tutorial home page</B></A>
<B> | </B>
<A href="../users/bibliography.html"><B>Bibliography</B></A>
<HR ALIGN=left>
Help files :
<A href="../users/new_user_guide.html"><B>New user's guide</B></A>
<B> | </B>
<A href="../users/abinis_help.html"><B>Abinis (main)</B></A>
<B> | </B>
<A href="../users/respfn_help.html"><B>Abinis (respfn)</B></A>
<B> | </B>
<A href="../users/mrgddb_help.html"><B>Mrgddb</B></A>
<B> | </B>
<A href="../users/anaddb_help.html"><B>Anaddb</B></A>
<B> | </B>
<A href="../users/aim_help.html"><B>AIM (Bader)</B></A>
<B> | </B>
<A href="../users/cut3d_help.html"><B>Cut3D</B></A>
<B> | </B>
<A href="../users/optic_help.html"><B>Optic</B></A>
<B> | </B>
<A href="../users/mrgscr_help.html"><B>Mrgscr</B></A>
<HR ALIGN=left>

</body>
</html>
