<html>
<head><title>ABINIT : PARALLELISATION input variables.</title>
<link rel=stylesheet type="text/css" href="formabinit.css">
</head>
<body bgcolor="#ffffff">

<hr>
<a name="top"></a>

<h1>ABINIT parallelisation input variables:</h1>
<h2>List and description.</h2>

<hr>

<p>This document lists and provides the description
of the name (keywords) of parallelisation input
variables to be used in the main input file of the abinis code.

<p>The new user is advised to read first the
  <a href="../users/new_user_guide.html">new user's guide</a>,
  before reading the present file. It will be easier to discover the
  present file with the help of the <a href="../tutorial/welcome.html">tutorial</a>.

<p>When the user is sufficiently familiarized with ABINIT, the reading of the
  ~abinit/doc/users/tuning file might be useful. For response-function calculations using
  abinis, please read <a href="../users/respfn_help.html">the response function help file</a>

<h5>Copyright (C) 1998-2008 ABINIT group (DCA, XG, RC)
<br> This file is distributed under the terms of the GNU General Public License, see
~abinit/COPYING or <a href="http://www.gnu.org/copyleft/gpl.txt">
http://www.gnu.org/copyleft/gpl.txt </a>.
<br> For the initials of contributors, see ~abinit/doc/developers/contributors.txt .
</h5>

<HR ALIGN=left>
Goto :
<A href="http://www.abinit.org"><B>ABINIT home Page</B></A>
<B> | </B>
<A href="../users/acknowledgments.html"><B>Suggested acknowledgments</B></A>
<B> | </B>
<A href="keyhr.html"><B>List of input variables</B></A>
<B> | </B>
<A href="../tutorial/welcome.html"><B>Tutorial home page</B></A>
<B> | </B>
<A href="../users/bibliography.html"><B>Bibliography</B></A>
<HR ALIGN=left>
Help files :
<A href="../users/new_user_guide.html"><B>New user's guide</B></A>
<B> | </B>
<A href="../users/abinis_help.html"><B>Abinis (main)</B></A>
<B> | </B>
<A href="../users/respfn_help.html"><B>Abinis (respfn)</B></A>
<B> | </B>
<A href="../users/mrgddb_help.html"><B>Mrgddb</B></A>
<B> | </B>
<A href="../users/anaddb_help.html"><B>Anaddb</B></A>
<B> | </B>
<A href="../users/aim_help.html"><B>AIM (Bader)</B></A>
<B> | </B>
<A href="../users/cut3d_help.html"><B>Cut3D</B></A>
<B> | </B>
<A href="../users/optic_help.html"><B>Optic</B></A>
<B> | </B>
<A href="../users/mrgscr_help.html"><B>Mrgscr</B></A>
<HR ALIGN=left>

Files that describe other input variables:<br>
<ul>
<li> Basic variables, <A href="varbas.html">VARBAS</a></li>
<li> Developper variables, <A href="vardev.html">VARDEV</a></li>
<li> File handling variables, <A href="varfil.html">VARFIL</a></li>
<li> Geometry builder + symmetry related variables, <A href="vargeo.html">VARGEO</a></li>
<li> Ground-state calculation variables, <A href="vargs.html">VARGS</a></li>
<li> GW variables, <A href="vargw.html">VARGW</a></li>
<li> Internal variables, <A href="varint.html">VARINT</a></li>
<li> Projector-Augmented Wave variables, <A href="varpaw.html">VARPAW</a></li>
<li> Response Function variables, <A href="varrf.html">VARRF</a></li>
<li> Structural optimization variables, <A href="varrlx.html">VARRLX</a></li>
<li> Wannier90 interface variables, <A href="varw90.html">VARW90</a></li>
</ul>
<hr>

<h3><b> Content of the file : alphabetical list of variables.</b></h3>
 <br>A.
 <br>B.
 <br>C.
 <br>D.
 <br>E.
 <br>F.
 <a href="varpar.html#fft_opt_lob">fft_opt_lob</a>&nbsp;&nbsp;
 <br>G.
 <a href="varpar.html#gwpara">gwpara</a>&nbsp;&nbsp;
 <br>H.
 <br>I.
 <br>J.
 <br>K.
 <br>L.
 <a href="varpar.html#localrdwf">localrdwf</a>&nbsp;&nbsp;
 <br>M.
 <br>N.
 <a href="varpar.html#ngroup_rf">ngroup_rf</a>&nbsp;&nbsp;
 <a href="varpar.html#npband">npband</a>&nbsp;&nbsp;
 <a href="varpar.html#npfft">npfft</a>&nbsp;&nbsp;
 <a href="varpar.html#npkpt">npkpt</a>&nbsp;&nbsp;
 <br>O.
 <br>P.
 <a href="varpar.html#paral_kgb">paral_kgb</a>&nbsp;&nbsp;
 <a href="varpar.html#paral_rf">paral_rf</a>&nbsp;&nbsp;
 <br>Q.
 <br>R.
 <br>S.
 <br>T.
 <br>U.
 <br>V.
 <br>W.
 <br>X.
 <br>Y.
 <br>Z.

<br><br><br><br><hr>

<font id="title"><a name="fft_opt_lob">fft_opt_lob</a></font>
<br><font id="definition">Mnemonics: Fast Fourier Transform parallelisation - OPTion for LOB algorithm </font>
<br><font id="category">Characteristic:  </font>
<br><font id="vartype">Variable type: integer </font>
<br><font id="default">Default is 0.</font>
<br><br><font id="text">
Option for LOB algorithm, used in the band/FFT/k-point parallelisation,
see <a href="varpar.html#npband">npband</a>, <a href="varpar.html#npfft">npfft</a>,
<a href="varpar.html#npkpt">npkpt</a>, and <a href="varpar.html#paral_kgb">paral_kgb</a>.
<ul>
<li> =1 : old implementation </li>
<li> =2 : new implementation : the
calls to getghc are made in parallel on a set of bands 
<a href="vardev.html#nbdblock">nbdblock</a> :
the aim is to reduce the number of collective communications. This is
not yet implemented in lobpcgwf. </li>
</ul>
</font>

<br><br><br><br><a href=#top>Go to the top</a>
<B> | </B><a href="keyhr.html#list">Complete list of input variables</a><hr>

<font id="title"><a name="gwpara">gwpara</a></font>
<br><font id="definition">Mnemonics: GW PARAllelization level </font>
<br><font id="category">Characteristic: GW, PARALLEL</font>
<br><font id="vartype">Variable type: integer </font>
<br><font id="default">Default is 1 <B>TODO: default should be 2</b>.</font>
<br><br><font id="text">
<p> 
Only relevant if <a href="vargs.html#optdriver">optdriver</a>=3 or 4, that is, screening or sigma calculations.
<p> 
<b>gwpara</b> is used to choose between the two different parallelization levels 
available in the GW code. The available options are:

<ul>
<li> =1 =&gt; parallelisation on k points </li>
<li> =2 =&gt; parallelisation on bands    </li>
</ul>

<p>
Additional notes:
<br>
In the present status of the code, only the parallelization over bands (<b>gwpara</b>=2)
allows to reduce the memory allocated by each processor. 
<!--In this case, indeed, the 
empty states are divided among the different processors, while the occupied states are copied on each CPU.
-->
<br>
Using <b>gwpara</b>=1, indeed, requires the same amount of memory as a sequential run,
irrespectively of the number of CPU's used.
<p>
A reduction of the requireed memory can be achieved by opting for an out-of-core solution 
(<a href="varfil.html#mkmem">mkmem</a>=0, only coded for <a href="vargw.html#optdriver">optdriver</a>=3) 
at the price of a drastic worsening of the performance. 
<!--
<p>
The input variable <a href="varpar.html#localrdwf">localrdwf</a> is used to define 
the way used by the different processors to read the KSS and SCR files.
-->
</font>


<br><br><br><br><a href=#top>Go to the top</a>
<B> | </B><a href="keyhr.html#list">Complete list of input variables</a><hr>

<font id="title"><a name="localrdwf">localrdwf</a></font>
<br><font id="definition">Mnemonics: LOCAL ReaD WaveFunctions</font>
<br><font id="category">Characteristic: DEVELOP, PARALLEL </font>
<br><font id="vartype">Variable type: integer </font>
<br><font id="default">Default is 1.</font>
<br><br><font id="text">
This input variable is used only in abinip.
If <b>localrdwf</b>=1, the input wavefunction disk file or the KSS/SCR file in case of GW
calculations, is read locally by each processor, while
if <b>localrdwf</b>=0, only one processor reads it, and
broadcast the data to the other processors.
<p> The option <b>localrdwf</b>=0 is NOT allowed when
<a href="varfil.html#mkmem">mkmem</a>==0 (or, for RF, when
<a href="varpar.html#mkqmem">mkqmem</a>==0, or <a href="varpar.html#mk1mem">mk1mem</a>==0), that
is, when the wavefunctions are stored on disk.
This is still to be coded ...
<p> In the case of a parallel computer with a unique file system,
both options are as convenient for the user. However, if the I/O
are slow compared to communications between processors,
(e.g. for CRAY T3E machines), <b>localrdwf</b>=0 should be much more
efficient;
if you really need temporary disk storage, switch to localrdwf=1 ).
<p> In the case of a cluster of nodes, with a different file system for
each machine, the input wavefunction file must be available on all
nodes if <b>localrdwf</b>=1, while it is needed only for the
master node if <b>localrdwf</b>=0.

</font>

<br><br><br><br><a href=#top>Go to the top</a>
<B> | </B><a href="keyhr.html#list">Complete list of input variables</a><hr>


<font id="title"><a name="ngroup_rf">ngroup_rf</a></font>
<br><font id="definition">Mnemonics: Define the number of groups for parallelization over perturbations </font>
<br><font id="category">Characteristic: can even be specified separately for each dataset, parameter paral_rf is necessary </font>
<br><font id="vartype">Variable type: integer </font>
<br><font id="default">Default is 0.</font>
<br><br><font id="text">
This parameter is used in connection to the parallelization over perturbations. It defines the number
of groups for distributing the perturbation-cases over the total number of available processors. The maximum number of groups is limited by the number of perturbation cases. The size of each group is again limited by the number k-points.
</font>

<br><br><br><br><a href=#top>Go to the top</a>
<B> | </B><a href="keyhr.html#list">Complete list of input variables</a><hr>


<font id="title"><a name="npband">npband</a></font>
<br><font id="definition">Mnemonics: Number of Processors at the BAND level </font>
<br><font id="category">Characteristic: </font>
<br><font id="vartype">Variable type: integer </font>
<br><font id="default">Default is 1.</font>
<br><br><font id="text">
Relevant only for the band/FFT parallelisation 
(see the <a href="varpar.html#paral_kgb">paral_kgb</a> input variable).
<br> <b>npband</b> gives the number of processors among which the work load over the band level is shared.
<b>npband</b>, <a href="varpar.html#npfft">npfft</a> and
<a href="varpar.html#npkpt">npkpt</a> are combined to give the total number
of processors (nproc) working on the band/FFT/k-point parallelisation.
See <a href="varpar.html#npfft">npfft</a>, <a href="varpar.html#npkpt">npkpt</a>, and 
<a href="varpar.html#paral_kgb">paral_kgb</a> for the additional information on the use of
band/FFT/k-point parallelisation.
<p>
Note : at present, <b>npband</b> has to be a divisor or equal to <a href="varbas.html#nband">nband</a>
</font>

<br><br><br><br><a href=#top>Go to the top</a>
<B> | </B><a href="keyhr.html#list">Complete list of input variables</a><hr>


<font id="title"><a name="npfft">npfft</a></font>
<br><font id="definition">Mnemonics: Number of Processors at the FFT level </font>
<br><font id="category">Characteristic: </font>
<br><font id="vartype">Variable type: integer </font>
<br><font id="default">Default is nproc.</font>
<br><br><font id="text">
Relevant only for the band/FFT/k-point parallelisation
(see the <a href="varpar.html#paral_kgb">paral_kgb</a> input variable).
<br> <b>npfft</b> gives the number of processors among 
which the work load over the FFT level is shared.
<b>npfft</b>, <a href="varpar.html#npkpt">npkpt</a> and
<a href="varpar.html#npband">npband</a> are combined to give the total number
of processors (nproc) working on the band/FFT/k-point parallelisation.
See <a href="varpar.html#npband">npband</a>, <a href="varpar.html#npkpt">npkpt</a>, and
<a href="varpar.html#paral_kgb">paral_kgb</a> for the additional information on the use of
band/FFT/k-point parallelisation.
<p>

Note : <b>npfft</b> should be a divisor or equal to the number of FFT planes
along the 2nd and 3rd dimensions 
(<a href="vargs.html#ngfft">ngfft</a>(2) and <a href="vargs.html#ngfft">ngfft</a>(3)), respectively,
and smaller than
min(<a href="vargs.html#ngfft">ngfft</a>(2),<a href="vargs.html#ngfft">ngfft</a>(3))/2.
<br>
</font>

<br><br><br><br><a href=#top>Go to the top</a>
<B> | </B><a href="keyhr.html#list">Complete list of input variables</a><hr>


<font id="title"><a name="npkpt">npkpt</a></font>
<br><font id="definition">Mnemonics: Number of Processors at the k-point level </font>
<br><font id="category">Characteristic: </font>
<br><font id="vartype">Variable type: integer </font>
<br><font id="default">Default is 1.</font>
<br><br><font id="text">
Relevant only for the band/FFT/k-point parallelisation
(see the <a href="varpar.html#paral_kgb">paral_kgb</a> input variable).
<br> <b>npkpt</b> gives the number of processors among
which the work load over the k-point/spin-component level is shared.
<b>npkpt</b>, <a href="varpar.html#npfft">npfft</a> and
<a href="varpar.html#npband">npband</a> are combined to give the total number
of processors (nproc) working on the band/FFT/k-point parallelisation.
See <a href="varpar.html#npband">npband</a>, <a href="varpar.html#npfft">npfft</a>, and
<a href="varpar.html#paral_kgb">paral_kgb</a> for the additional information on the use of
band/FFT/k-point parallelisation.
<p>

Note : <b>npkpt</b> should be a divisor or equal to with the number of k-point/spin-components
(<a href="varbas.html#nkpt">nkpt</a>*<a href="varbas.html#nsppol">nsppol</a>) 
in order to have the better load-balancing and efficiency.
<br>
</font>

<br><br><br><br><a href=#top>Go to the top</a>
<B> | </B><a href="keyhr.html#list">Complete list of input variables</a><hr>


<font id="title"><a name="paral_kgb">paral_kgb</a></font>
<br><font id="definition">Mnemonics: activate PARALelization over K point, G vectors and Bands.</font>
<br><font id="category">Characteristic: can not be specified separately for each dataset.  </font>
<br><font id="vartype">Variable type: integer </font>
<br><font id="default">Default is 0.</font>
<br><br><font id="text">
<p>
If paral_kgb=1, 
the parallelization over bands, FFTs, and k-point/spin-components is activated
(see <a href="varpar.html#npkpt">npkpt</a>, <a href="varpar.html#npfft">npfft</a> and
<a href="varpar.html#npband">npband</a>). With this parallelization, the work load is split over
three levels of parallelization. The different communications almost occur
along one dimension only. Require compilation option --enable-mpi="yes".
</p>

The keywords
<a href="vardev.html#wfoptalg">wfoptalg</a>=4,
<a href="vardev.html#nloalg">nloalg</a>=4,
<a href="vardev.html#fftalg">fftalg</a>=401,
<a href="vardev.html#intxc">intxc</a>=0,
and <a href="varpar.html#fft_opt_lob">fft_opt_lob</a>=2
have to be used for a band/FFT/k-point parallelisation.
<br>
Spin-polarized (
<a href="varbas.html#nsppol">nsppol</a>=2 
or
<a href="varbas.html#nspden">nspden</a>=2) 
 as well as PAW method calculations
    are now allowed in production in the framework of
    band/FFT/k-point parallelisation.
    Precondition of density and/or correction of forces (see 
<a href="vardev.html#iprcch">iprcch</a>) and time-reversal
    symmetry (
<a href="vardev.html#istwfk">istwfk</a>=2) are now available for beta tests.
<p>

HOWTO fix the number of processors along one level of parallelisation:
<br>
At first, try to parallelise over the k point and spin 
(see <a href="varpar.html#npkpt">npkpt</a>).
Otherwise, for unpolarized calculation at the gamma point, parallelise over the 
two other levels: the band and FFT ones. For nproc<=50,
the best speed-up is achieved for
<a href="varpar.html#npband">npband</a>=nproc and 
<a href="varpar.html#npfft">npfft</a>npfft=1 (which is not yet the default).
For nproc>=50, the best speed-up is achieved for 
<a href="varpar.html#npband">npband</a> >=4*<a href="varpar.html#npfft">npfft</a>.
<p>
For additional information, 
download F. Bottin's presentation at the <a href="http://www.abinit.org/workshop_07/program.html">ABINIT workshop 2007</a>
<p>
Suggested acknowledgments :
<br>
F. Bottin, S. Leroux, A. Knyazev and G. Zerah,
<i>Large scale ab initio calculations based on three levels of parallelization</i>,
Comput. Mat. Science <b>42</b>, 329 (2008),
<a href="http://www.arxiv.org/abs/0707.3405">available on arXiv</a>.


</font>


<br><br><br><br><a href=#top>Go to the top</a>
<B> | </B><a href="keyhr.html#list">Complete list of input variables</a><hr>

<font id="title"><a name="paral_rf">paral_rf</a></font>
<br><font id="definition">Mnemonics: Activate parallelization over perturbations </font>
<br><font id="category">Characteristic: can even be specified separately for each dataset, parameter ngroup_rf is necessary </font>
<br><font id="vartype">Variable type: integer </font>
<br><font id="default">Default is 0.</font>
<br><br><font id="text">
<p>
This parameter activates the parallelization over perturbations which can be used during
RF-Calculation. It is possible to use this type of parallelization in combination to the
parallelization over k-points.
</p>
<p>
Currently total energies calculated by groups, where the master process is not in, are saved
in .status_LOGxxxx files.
</p>


</font>

<br><br><br><br><a href=#top>Go to the top</a>
<B> | </B><a href="keyhr.html#list">Complete list of input variables</a><hr>

Goto :
<A href="http://www.abinit.org"><B>ABINIT home Page</B></A>
<B> | </B>
<A href="../users/acknowledgments.html"><B>Suggested acknowledgments</B></A>
<B> | </B>
<A href="keyhr.html"><B>List of input variables</B></A>
<B> | </B>
<A href="../tutorial/welcome.html"><B>Tutorial home page</B></A>
<B> | </B>
<A href="../users/bibliography.html"><B>Bibliography</B></A>
<HR ALIGN=left>
Help files :
<A href="../users/new_user_guide.html"><B>New user's guide</B></A>
<B> | </B>
<A href="../users/abinis_help.html"><B>Abinis (main)</B></A>
<B> | </B>
<A href="../users/respfn_help.html"><B>Abinis (respfn)</B></A>
<B> | </B>
<A href="../users/mrgddb_help.html"><B>Mrgddb</B></A>
<B> | </B>
<A href="../users/anaddb_help.html"><B>Anaddb</B></A>
<B> | </B>
<A href="../users/aim_help.html"><B>AIM (Bader)</B></A>
<B> | </B>
<A href="../users/cut3d_help.html"><B>Cut3D</B></A>
<B> | </B>
<A href="../users/optic_help.html"><B>Optic</B></A>
<B> | </B>
<A href="../users/mrgscr_help.html"><B>Mrgscr</B></A>
<HR ALIGN=left>

</body>
</html>

